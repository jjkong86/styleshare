<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="styleshare.task.mapper.CommerceMapper">

	<resultMap type="styleshare.task.model.Goods" id="parserGoods">
		<id column="id" property="id"/>
		<result column="name" property="name"/>
		<result column="provider" property="provider"/>
		<result column="price" property="price"/>
		<collection property="shipping" resultMap="shipping"/>
	</resultMap>
	
	<resultMap type="styleshare.task.model.Shipping" id="shipping">
		<result column="shipping_method" property="method"/>
		<result column="shipping_price" property="price"/>
		<result column="shipping_canBundle" property="canBundle"/>
	</resultMap>
	
	<resultMap type="styleshare.task.model.GoodsDetail" id="parserGoodsDetail">
		<id column="id" property="id"/>
		<result column="color" property="color"/>
		<result column="size" property="size"/>
		<result column="stock" property="stock"/>
		<result column="goods_id" property="goods_id"/>
		<result column="regDtm" property="regDtm"/>
		<result column="updDtm" property="updDtm"/>
	</resultMap>

	<insert id="insertGoods" parameterType="goods">
		INSERT INTO GOODS (
			id, name, provider, price, shipping_method, shipping_price, 
			shipping_canBundle)
		VALUES (#{id}, #{name}, #{provider}, #{price}, #{shipping.method}, #{shipping.price}, #{shipping.canBundle})
	</insert>
	
	<insert id="insertGoodsDetail">
		INSERT INTO GOODS_DETAIL (id, color, size, stock, goods_id)
		VALUES (#{id}, #{color}, #{size}, #{stock}, #{goods_id})
	</insert>
	
	<select id="goodsAll" resultMap="parserGoods">
		SELECT * FROM GOODS ORDER BY ID ASC
	</select>
	
	<select id="goodsDetailAll" resultMap="parserGoodsDetail">
		SELECT * FROM GOODS_DETAIL ORDER BY GOODS_ID ASC
	</select>
	
	<select id="goodsToId">
		SELECT * FROM GOODS WHERE ID = #{id}
	</select>
	
	<insert id="insertGoodsToCart" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO CART('GOODS_ID', 'GOODS_DETAIL_ID', 'REG_DTM', 'UPD_DTM')
		VALUES (#{GOODS_ID}, #{GOODS_DETAIL_ID}, NOW(), NOW()) 
	</insert>
	
	<insert id="putAllGoodsToCart" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO CART('GOODS_ID', 'GOODS_DETAIL_ID', 'REG_DTM', 'UPD_DTM')
		SELECT GOODS_ID, ID, NOW(), NOW() FROM GOODS_DETAIL WHERE 1=1
		<if test="goodsList != null">
			ID IN
			<foreach collection="goodsList" item="goodsList" separator="," open="(" close=")">
				#{goodsList.goods_detail_id}
			</foreach>
		</if> 
	</insert>
</mapper>